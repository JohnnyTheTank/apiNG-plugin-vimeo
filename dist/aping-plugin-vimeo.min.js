
/*! aping-plugin-vimeo v0.1.4 (22-12-2015) by Jonathan Hornung */
"use strict";var jjtApingVimeo=angular.module("jtt_aping_vimeo",["jtt_vimeo"]).directive("apingVimeo",["apingApiKeys","apingVimeoHelper","apingUtilityHelper","vimeoFactory",function(a,b,c,d){return{require:"?aping",restrict:"A",replace:"false",link:function(a,e,f,g){var h=g.getAppSettings(),i=c.parseJsonFromAttributes(f.apingVimeo,b.getThisPlattformString(),h);i.forEach(function(a){var e={model:h.model};"undefined"!=typeof h.getNativeData?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={access_token:c.getApiCredentials(b.getThisPlattformString(),"access_token")};return"undefined"!=typeof a.items?f.per_page=a.items:f.per_page=h.items,0==f.per_page?!1:((f.per_page<0||isNaN(f.per_page))&&(f.per_page=void 0),f.per_page>50&&(f.per_page=50),"undefined"!=typeof a.search&&(f.query=a.search),void(a.user?(f.user=a.user,f.filter="embeddable",f.filter_embeddable=!0,d.getVideosFromUser(f).success(function(a){a&&g.concatToResults(b.getObjectByJsonData(a,e))})):a.channel?(f.channel=a.channel,f.filter="embeddable",f.filter_embeddable=!0,d.getVideosFromChannel(f).success(function(a){a&&g.concatToResults(b.getObjectByJsonData(a,e))})):a.tag?(f.tag=a.tag,d.getVideosFromTag(f).success(function(a){a&&g.concatToResults(b.getObjectByJsonData(a,e))})):a.category&&(f.category=a.category,f.filter="embeddable",f.filter_embeddable=!0,d.getVideosFromCategory(f).success(function(a){a&&g.concatToResults(b.getObjectByJsonData(a,e))}))))})}}}]);jjtApingVimeo.service("apingVimeoHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlattformString=function(){return"vimeo"},this.getThisPlattformLink=function(){return"https://vimeo.com/"},this.getIdFromUri=function(a){return a.split("/").slice(-1)[0]},this.getActionCounter=function(a,b){return a[b]?a[b].total||!1:void 0},this.getGoodQualityImage=function(a){var b=4;return a.length>=b?a[b-1].link:a[a.length-1].link},this.getObjectByJsonData=function(a,b){var c=[];if(a){var d=this;a.data&&angular.forEach(a.data,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;case"video":c=this.getVideoItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(c){var d=a.getNew("social",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.user.name,blog_id:this.getIdFromUri(c.user.uri),blog_link:c.user.link,intern_type:"video",type:"video",intern_id:this.getIdFromUri(c.uri),img_url:this.getGoodQualityImage(c.pictures.sizes),timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),post_url:c.link,caption:c.name,text:c.description}),d.date_time=new Date(d.timestamp),c.embed&&c.embed.html&&(d.source=c.embed.html),d.text||(d.text=d.caption,d.caption=""),c.metadata&&c.metadata.connections&&(d.likes=this.getActionCounter(c.metadata.connections,"likes"),d.comments=this.getActionCounter(c.metadata.connections,"comments")),d},this.getVideoItemByJsonData=function(c){var d=a.getNew("video",this.getThisPlattformString());return $.extend(!0,d,{blog_name:c.user.name,blog_id:this.getIdFromUri(c.user.uri),blog_link:c.user.link,intern_id:this.getIdFromUri(c.uri),img_url:this.getGoodQualityImage(c.pictures.sizes),timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),post_url:c.link,caption:c.name,text:c.description}),d.date_time=new Date(d.timestamp),c.embed&&c.embed.html?(d.markup=c.embed.html,d.source=c.embed.html,d.text||(d.text=d.caption,d.caption=""),c.metadata&&c.metadata.connections&&(d.likes=this.getActionCounter(c.metadata.connections,"likes"),d.comments=this.getActionCounter(c.metadata.connections,"comments")),d):!1}}]),angular.module("jtt_vimeo",[]).factory("vimeoFactory",["$http","vimeoSearchDataService",function(a,b){var c={};return c.getVideosFromChannel=function(c){if(!c.channel)return!1;var d=b.getNew("videosFromChannel",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromCategory=function(c){if(!c.category)return!1;var d=b.getNew("videosFromCategory",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromTag=function(c){if(!c.tag)return!1;var d=b.getNew("videosFromTag",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromUser=function(c){if(!c.user)return!1;var d=b.getNew("videosFromUser",c);return a({method:"GET",url:d.url,params:d.object})},c}]).service("vimeoSearchDataService",function(){this.getApiBaseUrl=function(a){return"https://api.vimeo.com/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{access_token:b.access_token},url:""};switch(a){case"videosFromChannel":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"channels/"+b.channel+"/videos";break;case"videosFromCategory":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"categories/"+b.category+"/videos";break;case"videosFromTag":c=this.fillDataInObjectByList(c,b,["page","query","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"tags/"+b.tag+"/videos";break;case"videosFromUser":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"users/"+b.user+"/videos"}return c}});