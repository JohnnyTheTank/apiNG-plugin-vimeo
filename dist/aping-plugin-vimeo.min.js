/**
    @name: aping-plugin-vimeo 
    @version: 0.7.7 (26-01-2016) 
    @author: Jonathan Hornung <jonathan.hornung@gmail.com> 
    @url: https://github.com/JohnnyTheTank/apiNG-plugin-vimeo 
    @license: MIT
*/
"use strict";angular.module("jtt_aping_vimeo",["jtt_vimeo"]).directive("apingVimeo",["apingVimeoHelper","apingUtilityHelper","vimeoFactory",function(a,b,c){return{require:"?aping",restrict:"A",replace:"false",link:function(d,e,f,g){var h=g.getAppSettings(),i=b.parseJsonFromAttributes(f.apingVimeo,a.getThisPlattformString(),h);i.forEach(function(d){var e={model:h.model};"undefined"!=typeof h.getNativeData?e.getNativeData=h.getNativeData:e.getNativeData=!1;var f={access_token:b.getApiCredentials(a.getThisPlattformString(),"access_token")};return"undefined"!=typeof d.items?f.per_page=d.items:f.per_page=h.items,0===f.per_page||"0"===f.per_page?!1:((f.per_page<0||isNaN(f.per_page))&&(f.per_page=void 0),f.per_page>50&&(f.per_page=50),"undefined"!=typeof d.search&&(f.query=d.search),void(d.user?(f.user=d.user,f.filter="embeddable",f.filter_embeddable=!0,c.getVideosFromUser(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))})):d.channel?(f.channel=d.channel,f.filter="embeddable",f.filter_embeddable=!0,c.getVideosFromChannel(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))})):d.tag?(f.tag=d.tag,c.getVideosFromTag(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))})):d.category&&(f.category=d.category,f.filter="embeddable",f.filter_embeddable=!0,c.getVideosFromCategory(f).then(function(b){b&&g.concatToResults(a.getObjectByJsonData(b,e))}))))})}}}]),angular.module("jtt_aping_vimeo").service("apingVimeoHelper",["apingModels","apingTimeHelper","apingUtilityHelper",function(a,b,c){this.getThisPlattformString=function(){return"vimeo"},this.getThisPlattformLink=function(){return"https://vimeo.com/"},this.getIdFromUri=function(a){return a.split("/").slice(-1)[0]},this.getActionCounter=function(a,b){return a[b]?a[b].total||void 0:void 0},this.getGoodQualityImage=function(a){var b=4;return a.length>=b?a[b-1].link:a[a.length-1].link},this.getDifference=function(a,b){return a>b?a-b:b-a},this.getImagesFromImageArray=function(a){var b=this,c={thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0};return a.constructor===Array&&angular.forEach(a,function(a,d){"undefined"!=typeof a.link&&("undefined"==typeof c.thumb_url?(c.thumb_url=a.link,c.thumb_width=a.width,c.thumb_height=a.height):b.getDifference(c.thumb_width,200)>b.getDifference(a.width,200)&&a.width>=200&&(c.thumb_url=a.link,c.thumb_width=a.width,c.thumb_height=a.height),"undefined"==typeof c.img_url?(c.img_url=a.link,c.img_width=a.width,c.img_height=a.height):b.getDifference(c.img_width,700)>b.getDifference(a.width,700)&&(c.img_url=a.link,c.img_width=a.width,c.img_height=a.height),"undefined"==typeof c.native_url?(c.native_url=a.link,c.native_width=a.width,c.native_height=a.height):a.width>c.native_width&&(c.native_url=a.link,c.native_width=a.width,c.native_height=a.height))}),c},this.getObjectByJsonData=function(a,b){var c=[];if(a&&a.data){var d=this;a.data.data&&angular.forEach(a.data.data,function(a,e){var f;f=b.getNativeData===!0||"true"===b.getNativeData?a:d.getItemByJsonData(a,b.model),f&&c.push(f)})}return c},this.getItemByJsonData=function(a,b){var c={};if(a&&b)switch(b){case"social":c=this.getSocialItemByJsonData(a);break;case"video":c=this.getVideoItemByJsonData(a);break;default:return!1}return c},this.getSocialItemByJsonData=function(c){var d=a.getNew("social",this.getThisPlattformString());if($.extend(!0,d,{blog_name:c.user.name,blog_id:this.getIdFromUri(c.user.uri),blog_link:c.user.link,intern_type:"video",type:"video",intern_id:this.getIdFromUri(c.uri),timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),post_url:c.link,caption:c.name,text:c.description}),d.date_time=new Date(d.timestamp),c.pictures&&c.pictures.sizes.length>0){var e=this.getImagesFromImageArray(c.pictures.sizes);d.img_url=e.img_url||void 0,d.thumb_url=e.thumb_url||void 0,d.native_url=e.native_url||void 0}return c.embed&&c.embed.html&&(d.source=c.embed.html),d.text||(d.text=d.caption,d.caption=""),c.metadata&&c.metadata.connections&&(d.likes=this.getActionCounter(c.metadata.connections,"likes"),d.comments=this.getActionCounter(c.metadata.connections,"comments")),d},this.getVideoItemByJsonData=function(c){var d=a.getNew("video",this.getThisPlattformString());if($.extend(!0,d,{blog_name:c.user.name,blog_id:this.getIdFromUri(c.user.uri),blog_link:c.user.link,intern_id:this.getIdFromUri(c.uri),timestamp:b.getTimestampFromDateString(c.created_time,1e3,36e5),post_url:c.link,caption:c.name,text:c.description,duration:c.duration,width:c.width,height:c.height}),c.pictures&&c.pictures.sizes.length>0){var e=this.getImagesFromImageArray(c.pictures.sizes);d.img_url=e.img_url||void 0,d.thumb_url=e.thumb_url||void 0,d.native_url=e.native_url||void 0}return d.date_time=new Date(d.timestamp),c.embed&&c.embed.html?(d.markup=c.embed.html,d.text||(d.text=d.caption,d.caption=""),c.metadata&&c.metadata.connections&&(d.likes=this.getActionCounter(c.metadata.connections,"likes"),d.comments=this.getActionCounter(c.metadata.connections,"comments")),d):!1}}]),angular.module("jtt_vimeo",[]).factory("vimeoFactory",["$http","vimeoSearchDataService",function(a,b){var c={};return c.getVideosFromChannel=function(c){if(!c.channel)return!1;var d=b.getNew("videosFromChannel",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromCategory=function(c){if(!c.category)return!1;var d=b.getNew("videosFromCategory",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromTag=function(c){if(!c.tag)return!1;var d=b.getNew("videosFromTag",c);return a({method:"GET",url:d.url,params:d.object})},c.getVideosFromUser=function(c){if(!c.user)return!1;var d=b.getNew("videosFromUser",c);return a({method:"GET",url:d.url,params:d.object})},c}]).service("vimeoSearchDataService",function(){this.getApiBaseUrl=function(a){return"https://api.vimeo.com/"},this.fillDataInObjectByList=function(a,b,c){return angular.forEach(c,function(c,d){"undefined"!=typeof b[c]&&(a.object[c]=b[c])}),a},this.getNew=function(a,b){var c={object:{access_token:b.access_token},url:""};switch(a){case"videosFromChannel":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"channels/"+b.channel+"/videos";break;case"videosFromCategory":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"categories/"+b.category+"/videos";break;case"videosFromTag":c=this.fillDataInObjectByList(c,b,["page","query","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"tags/"+b.tag+"/videos";break;case"videosFromUser":c=this.fillDataInObjectByList(c,b,["page","query","filter","filter_embeddable","sort","direction","per_page"]),c.url=this.getApiBaseUrl()+"users/"+b.user+"/videos"}return c}});